SQLCli Release 0.0.97
SQL> connect admin/123456
Database connected.
SQL> start bucket/bucket.sql
SQL> --Description:partition
   > --Date：2020-06-30
   > --Author：阮娜
SQL> SET ECHO ON
SQL> SET TIMING ON
Running time elapsed:      0.00 Seconds
SQL> 
SQL> -- 删除视图
SQL> DROP VIEW V_BUC IF EXISTS;
0 rows affected
Running time elapsed:      0.05 Seconds
SQL> DROP VIEW V_BUC_1 IF EXISTS;
0 rows affected
Running time elapsed:      0.03 Seconds
SQL> -- 删除表
SQL> DROP TABLE T_BUC_INT IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_BOOLEAN IF EXISTS;
0 rows affected
Running time elapsed:      0.03 Seconds
SQL> DROP TABLE T_BUC_CHAR IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_DATE IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_DECIMAL IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_DOUBLE IF EXISTS;
0 rows affected
Running time elapsed:      0.03 Seconds
SQL> DROP TABLE T_BUC_FLOAT IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_NUMERIC IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_REAL IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_SMALLINT IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_TIMESTAMP IF EXISTS;
0 rows affected
Running time elapsed:      0.06 Seconds
SQL> DROP TABLE T_BUC_VARCHAR IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_BIGINT IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_ARRAY IF EXISTS;
0 rows affected
Running time elapsed:      0.05 Seconds
SQL> DROP TABLE T_BUC2 IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC3 IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_MONTH IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_LEN IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_ABS IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_MOD IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_FLOOR IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_TODATE IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_DAY IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_ROUND IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC2_FUNC2 IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC2_FUNC1 IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_EX1 IF EXISTS;
0 rows affected
Running time elapsed:      0.06 Seconds
SQL> DROP TABLE T_EX_DATA IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_PALLAS IF EXISTS;
0 rows affected
Running time elapsed:      0.00 Seconds
SQL> DROP TABLE T_BUC_1 IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE T_BUC_2 IF EXISTS;
0 rows affected
Running time elapsed:      0.04 Seconds
SQL> DROP TABLE EX_PART_BUC IF EXISTS;
0 rows affected
Running time elapsed:      0.05 Seconds
SQL> 
SQL> -- 创建外部表，10条数据
SQL> CREATE EXTERNAL TABLE EX_PART_BUC(TBIGINT BIGINT,TINT INT,TSMALLINT SMALLINT,TREAL REAL,TDOUBLE DOUBLE,TFLOAT FLOAT,TDECIMAL DECIMAL(10,2),TNUMERIC NUMERIC(10,4),TDATE DATE,TTIMESTAMP TIMESTAMP,TBOOL BOOLEAN,TCHAR CHAR(30),TVARCHAR VARCHAR(255))
   > location ('HDFSRPC_URL/partition_bucket/partition_bucket.csv') FORMAT 'csv' (DELIMITER ',');
REWROTED SQL> Your SQL has been changed to:
REWROTED    > CREATE EXTERNAL TABLE EX_PART_BUC(TBIGINT BIGINT,TINT INT,TSMALLINT SMALLINT,TREAL REAL,TDOUBLE DOUBLE,TFLOAT FLOAT,TDECIMAL DECIMAL(10,2),TNUMERIC NUMERIC(10,4),TDATE DATE,TTIMESTAMP TIMESTAMP,TBOOL BOOLEAN,TCHAR CHAR(30),TVARCHAR VARCHAR(255))
REWROTED    > location ('hdfs://node73:8020/user/testdb73/jenkins/work/linkoopdb-sql-test-ruanna/partition_bucket/partition_bucket.csv') FORMAT 'csv' (DELIMITER ',')
0 rows affected
Running time elapsed:      0.06 Seconds
SQL> 
SQL> -- 创建分桶表，以int类型列分桶
SQL> CREATE TABLE T_BUC_INT (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKETS;
0 rows affected
Running time elapsed:      0.06 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_INT;
+-----------+-----------------------------------------------------------------------------------------------------------------------+
| TABLE     | CREATE_TABLE                                                                                                          |
+-----------+-----------------------------------------------------------------------------------------------------------------------+
| T_BUC_INT | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_INT(A INTEGER,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKETS |
+-----------+-----------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_INT';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/d0d62db9-f590-4d2d-b0da-693ba03188e6","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":4} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，2个分桶，一个桶有9条数据，一个桶有1条数据
SQL> INSERT INTO T_BUC_INT SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.41 Seconds
SQL> -- 查询表T_BUC_INT
SQL> SELECT * FROM T_BUC_INT;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
+------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.40 Seconds
SQL> 
SQL> -- 创建分桶表，以boolean类型列分桶
SQL> CREATE TABLE T_BUC_BOOLEAN (A BOOLEAN, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 3 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_BOOLEAN;
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| TABLE         | CREATE_TABLE                                                                                                              |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| T_BUC_BOOLEAN | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_BOOLEAN(A BOOLEAN,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 3 BUCKETS |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_BOOLEAN';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/c2f03ea4-50a1-4fde-98b3-9e42eefbe83f","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":3} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，2个分桶，一个桶4条false数据，一个桶6条true数据
SQL> INSERT INTO T_BUC_BOOLEAN SELECT TBOOL, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.37 Seconds
SQL> -- 查询表T_BUC_BOOLEAN
SQL> SELECT * FROM T_BUC_BOOLEAN;
+-------+---------+------------------------------------------------------------------------------------------------------+
| A     | B       | C                                                                                                    |
+-------+---------+------------------------------------------------------------------------------------------------------+
| False | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| False | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| False | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| False | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| True  | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| True  | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| True  | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| True  | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| True  | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| True  | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
+-------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.39 Seconds
SQL> 
SQL> -- 创建分桶表，以char类型列分桶
SQL> CREATE TABLE T_BUC_CHAR (A CHAR(30), B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 2 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_CHAR;
+------------+-------------------------------------------------------------------------------------------------------------------------+
| TABLE      | CREATE_TABLE                                                                                                            |
+------------+-------------------------------------------------------------------------------------------------------------------------+
| T_BUC_CHAR | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_CHAR(A CHAR(30),B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 2 BUCKETS |
+------------+-------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_CHAR';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/462e7298-c385-4a06-b329-46511aec7fca","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":2} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，分桶字段值全都一致，1个分桶
SQL> INSERT INTO T_BUC_CHAR SELECT TCHAR, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      0.99 Seconds
SQL> -- 查询表T_BUC_CHAR
SQL> SELECT * FROM T_BUC_CHAR;
+--------------------------------+---------+------------------------------------------------------------------------------------------------------+
| A                              | B       | C                                                                                                    |
+--------------------------------+---------+------------------------------------------------------------------------------------------------------+
| abcdefghijklmnopqrstuvwxyzabcd | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| abcdefghijklmnopqrstuvwxyzabcd | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| abcdefghijklmnopqrstuvwxyzabcd | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| abcdefghijklmnopqrstuvwxyzabcd | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| abcdefghijklmnopqrstuvwxyzabcd | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| abcdefghijklmnopqrstuvwxyzabcd | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| abcdefghijklmnopqrstuvwxyzabcd | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| abcdefghijklmnopqrstuvwxyzabcd | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| abcdefghijklmnopqrstuvwxyzabcd | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| abcdefghijklmnopqrstuvwxyzabcd | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
+--------------------------------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.33 Seconds
SQL> 
SQL> -- 创建分桶表，以date类型列分桶
SQL> CREATE TABLE T_BUC_DATE (A DATE, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 1 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_DATE;
+------------+---------------------------------------------------------------------------------------------------------------------+
| TABLE      | CREATE_TABLE                                                                                                        |
+------------+---------------------------------------------------------------------------------------------------------------------+
| T_BUC_DATE | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_DATE(A DATE,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 1 BUCKETS |
+------------+---------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_DATE';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/3c53f320-8da2-4e40-a67c-692fa6ce1cf6","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":1} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.09 Seconds
SQL> -- 插入数据，1个分桶
SQL> INSERT INTO T_BUC_DATE SELECT TDATE, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      0.74 Seconds
SQL> -- 查询表T_BUC_DATE
SQL> SELECT * FROM T_BUC_DATE;
+------------+---------+------------------------------------------------------------------------------------------------------+
| A          | B       | C                                                                                                    |
+------------+---------+------------------------------------------------------------------------------------------------------+
| 1982-1-23  | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 1981-12-3  | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 1981-12-3  | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 1981-9-8   | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1998-7-21  | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1981-6-9   | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 1981-5-1   | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 1981-9-28  | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 1989-12-18 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 1980-12-17 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
+------------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.26 Seconds
SQL> 
SQL> -- 创建分桶表，以decimal类型列分桶
SQL> CREATE TABLE T_BUC_DECIMAL (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (B) INTO 5 BUCKETS;
0 rows affected
Running time elapsed:      0.09 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_DECIMAL;
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| TABLE         | CREATE_TABLE                                                                                                              |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| T_BUC_DECIMAL | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_DECIMAL(A INTEGER,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (B) INTO 5 BUCKETS |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_DECIMAL';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/b4488ea8-2f35-493c-a19b-1a537dd1ea0c","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["B"],"bucketNum":5} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，10条数据平均分到5个桶
SQL> INSERT INTO T_BUC_DECIMAL SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      0.92 Seconds
SQL> -- 查询表T_BUC_DECIMAL
SQL> SELECT * FROM T_BUC_DECIMAL;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
+------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.42 Seconds
SQL> 
SQL> -- 创建分桶表，以double类型列分桶
SQL> CREATE TABLE T_BUC_DOUBLE (A DOUBLE, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 10 BUCKETS;
0 rows affected
Running time elapsed:      0.07 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_DOUBLE;
+--------------+--------------------------------------------------------------------------------------------------------------------------+
| TABLE        | CREATE_TABLE                                                                                                             |
+--------------+--------------------------------------------------------------------------------------------------------------------------+
| T_BUC_DOUBLE | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_DOUBLE(A DOUBLE,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 10 BUCKETS |
+--------------+--------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_DOUBLE';
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                    |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/767f88f2-2e22-4017-84f7-0792ff9da0e3","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":10} |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，10条数据非平均分到5个桶
SQL> INSERT INTO T_BUC_DOUBLE SELECT TDOUBLE, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.23 Seconds
SQL> -- 查询表T_BUC_DOUBLE
SQL> SELECT * FROM T_BUC_DOUBLE;
+---------+---------+------------------------------------------------------------------------------------------------------+
| A       | B       | C                                                                                                    |
+---------+---------+------------------------------------------------------------------------------------------------------+
| 3797.61 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 3575.2  | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 3824.37 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 3867.12 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 2042.85 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 4740.62 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 9896.61 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 1108.07 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1169.82 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 2690.46 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
+---------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.57 Seconds
SQL> 
SQL> -- 创建分桶表，以float类型列分桶
SQL> CREATE TABLE T_BUC_FLOAT (A FLOAT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 6 BUCKETS;
0 rows affected
Running time elapsed:      0.42 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_FLOAT;
+-------------+-----------------------------------------------------------------------------------------------------------------------+
| TABLE       | CREATE_TABLE                                                                                                          |
+-------------+-----------------------------------------------------------------------------------------------------------------------+
| T_BUC_FLOAT | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_FLOAT(A FLOAT,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 6 BUCKETS |
+-------------+-----------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_FLOAT';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/a2c2ca93-4db8-437e-88c9-c1350f4beb21","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":6} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，10条数据非平均分到5个桶
SQL> INSERT INTO T_BUC_FLOAT SELECT TFLOAT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.22 Seconds
SQL> -- 查询表T_BUC_FLOAT
SQL> SELECT * FROM T_BUC_FLOAT;
+---------+---------+------------------------------------------------------------------------------------------------------+
| A       | B       | C                                                                                                    |
+---------+---------+------------------------------------------------------------------------------------------------------+
| 2946.04 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 9506.85 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 5296.49 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 2608.45 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 8639.29 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 412.9   | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 2592.84 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 1169.33 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 6490.95 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1937.72 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
+---------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.47 Seconds
SQL> 
SQL> -- 创建分桶表，以NUMERIC类型列分桶
SQL> CREATE TABLE T_BUC_NUMERIC (A NUMERIC(10,4), B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 7 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_NUMERIC;
+---------------+---------------------------------------------------------------------------------------------------------------------------------+
| TABLE         | CREATE_TABLE                                                                                                                    |
+---------------+---------------------------------------------------------------------------------------------------------------------------------+
| T_BUC_NUMERIC | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_NUMERIC(A NUMERIC(10,4),B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 7 BUCKETS |
+---------------+---------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_NUMERIC';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/8f910fba-5f0f-4267-a18c-e3756277583b","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":7} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.08 Seconds
SQL> -- 插入数据，分桶字段值有null，4个分桶
SQL> INSERT INTO T_BUC_NUMERIC SELECT TNUMERIC, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.40 Seconds
SQL> -- 查询表T_BUC_NUMERIC
SQL> SELECT * FROM T_BUC_NUMERIC;
+-----------+---------+------------------------------------------------------------------------------------------------------+
| A         | B       | C                                                                                                    |
+-----------+---------+------------------------------------------------------------------------------------------------------+
| 5972.95   | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| <null>    | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| <null>    | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 2946.5426 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 9869.2003 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 2946.5426 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 2963.901  | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 3846.5961 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 3846.5961 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 6167.0253 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
+-----------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.52 Seconds
SQL> 
SQL> -- 创建分桶表，以REAL类型列分桶
SQL> CREATE TABLE T_BUC_REAL (A REAL, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 8 BUCKETS;
0 rows affected
Running time elapsed:      0.07 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_REAL;
+------------+-----------------------------------------------------------------------------------------------------------------------+
| TABLE      | CREATE_TABLE                                                                                                          |
+------------+-----------------------------------------------------------------------------------------------------------------------+
| T_BUC_REAL | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_REAL(A DOUBLE,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 8 BUCKETS |
+------------+-----------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_REAL';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/60c5d369-e096-4935-a2af-6b4b0d442a5a","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":8} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.08 Seconds
SQL> -- 插入数据，6个分桶
SQL> INSERT INTO T_BUC_REAL SELECT TREAL, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.15 Seconds
SQL> -- 查询表T_BUC_REAL
SQL> SELECT * FROM T_BUC_REAL;
+---------+---------+------------------------------------------------------------------------------------------------------+
| A       | B       | C                                                                                                    |
+---------+---------+------------------------------------------------------------------------------------------------------+
| 5537.86 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 3036.58 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7724.82 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 296.58  | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 2963.33 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 2829.49 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 8901.04 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 3487.25 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 345.41  | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 9931.54 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
+---------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.51 Seconds
SQL> 
SQL> -- 创建分桶表，以SMALLINT类型列分桶
SQL> CREATE TABLE T_BUC_SMALLINT (A SMALLINT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 9 BUCKETS;
0 rows affected
Running time elapsed:      0.07 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_SMALLINT;
+----------------+-----------------------------------------------------------------------------------------------------------------------------+
| TABLE          | CREATE_TABLE                                                                                                                |
+----------------+-----------------------------------------------------------------------------------------------------------------------------+
| T_BUC_SMALLINT | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_SMALLINT(A SMALLINT,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 9 BUCKETS |
+----------------+-----------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_SMALLINT';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/e1692c93-29c3-4da6-884b-c9245aeef476","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":9} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据
SQL> INSERT INTO T_BUC_SMALLINT SELECT TSMALLINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      0.87 Seconds
SQL> -- 查询表T_BUC_SMALLINT
SQL> SELECT * FROM T_BUC_SMALLINT;
+----+---------+------------------------------------------------------------------------------------------------------+
| A  | B       | C                                                                                                    |
+----+---------+------------------------------------------------------------------------------------------------------+
| 10 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 10 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 10 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 20 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 30 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 30 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 30 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 30 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 30 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 30 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
+----+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.46 Seconds
SQL> 
SQL> -- 创建分桶表，以TIMESTAMP类型列分桶
SQL> CREATE TABLE T_BUC_TIMESTAMP (A TIMESTAMP, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 13 BUCKETS;
0 rows affected
Running time elapsed:      0.20 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_TIMESTAMP;
+-----------------+--------------------------------------------------------------------------------------------------------------------------------+
| TABLE           | CREATE_TABLE                                                                                                                   |
+-----------------+--------------------------------------------------------------------------------------------------------------------------------+
| T_BUC_TIMESTAMP | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_TIMESTAMP(A TIMESTAMP,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 13 BUCKETS |
+-----------------+--------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_TIMESTAMP';
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                    |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/d4ce093d-89d2-481e-83b5-313e594db83f","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":13} |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.08 Seconds
SQL> -- 插入数据，8个分桶
SQL> INSERT INTO T_BUC_TIMESTAMP SELECT TTIMESTAMP, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.54 Seconds
SQL> -- 查询表T_BUC_TIMESTAMP
SQL> SELECT * FROM T_BUC_TIMESTAMP;
+---------------------+---------+------------------------------------------------------------------------------------------------------+
| A                   | B       | C                                                                                                    |
+---------------------+---------+------------------------------------------------------------------------------------------------------+
| 2034-07-06 17:55:27 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 2027-04-17 04:52:37 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 2028-09-24 20:44:53 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 2027-01-10 13:04:17 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 2048-04-12 17:48:56 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 2045-10-31 11:25:51 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 1986-08-19 19:45:36 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 2033-09-24 12:24:45 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1998-01-23 20:58:41 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 2034-12-31 09:06:46 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
+---------------------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.78 Seconds
SQL> 
SQL> -- 创建分桶表，以VARCHAR类型列分桶
SQL> CREATE TABLE T_BUC_VARCHAR (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (C) INTO 997 BUCKETS;
0 rows affected
Running time elapsed:      0.09 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_VARCHAR;
+---------------+-----------------------------------------------------------------------------------------------------------------------------+
| TABLE         | CREATE_TABLE                                                                                                                |
+---------------+-----------------------------------------------------------------------------------------------------------------------------+
| T_BUC_VARCHAR | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_VARCHAR(A INTEGER,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (C) INTO 997 BUCKETS |
+---------------+-----------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.01 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_VARCHAR';
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                     |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/55d83b8e-eb1b-4847-8ea6-0d5dd2a1586b","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["C"],"bucketNum":997} |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.09 Seconds
SQL> -- 插入数据，9个分桶
SQL> INSERT INTO T_BUC_VARCHAR SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.45 Seconds
SQL> -- 查询表T_BUC_VARCHAR
SQL> SELECT * FROM T_BUC_VARCHAR;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
+------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:     14.86 Seconds
SQL> 
SQL> -- 创建分桶表，以BIGINT类型列分桶
SQL> CREATE TABLE T_BUC_BIGINT (A BIGINT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 100 BUCKETS;
0 rows affected
Running time elapsed:      0.12 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_BIGINT;
+--------------+---------------------------------------------------------------------------------------------------------------------------+
| TABLE        | CREATE_TABLE                                                                                                              |
+--------------+---------------------------------------------------------------------------------------------------------------------------+
| T_BUC_BIGINT | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_BIGINT(A BIGINT,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 100 BUCKETS |
+--------------+---------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_BIGINT';
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                     |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/bd3e7495-62cd-425b-8283-87eed96f5ffa","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":100} |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.08 Seconds
SQL> -- 插入数据，10分桶
SQL> INSERT INTO T_BUC_BIGINT SELECT TBIGINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.25 Seconds
SQL> -- 查询表T_BUC_BIGINT
SQL> SELECT * FROM T_BUC_BIGINT;
+---------+---------+------------------------------------------------------------------------------------------------------+
| A       | B       | C                                                                                                    |
+---------+---------+------------------------------------------------------------------------------------------------------+
| 1000005 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1000006 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 1000007 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 1000010 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 1000001 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 1000009 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 1000003 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 1000004 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 1000008 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 1000002 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
+---------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      1.76 Seconds
SQL> 
SQL> -- 创建分桶表，以ARRAY类型列分桶
SQL> CREATE TABLE T_BUC_ARRAY (A INT ARRAY, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 2 BUCKETS;
0 rows affected
Running time elapsed:      0.10 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_ARRAY;
+-------------+-------------------------------------------------------------------------------------------------------------------------------+
| TABLE       | CREATE_TABLE                                                                                                                  |
+-------------+-------------------------------------------------------------------------------------------------------------------------------+
| T_BUC_ARRAY | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC_ARRAY(A INTEGER ARRAY,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A) INTO 2 BUCKETS |
+-------------+-------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_ARRAY';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                   |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/d5467311-8ce8-4f51-9b9c-99a89e805601","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A"],"bucketNum":2} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，3个分桶
SQL> INSERT INTO T_BUC_ARRAY VALUES (ARRAY[1,2], 1.1, 'a'), (ARRAY[1,2], 2.2, 'b'), (ARRAY[2,3], 3.3, 'c');
3 rows affected
Running time elapsed:      0.99 Seconds
SQL> -- 查询表T_BUC_ARRAY
SQL> SELECT * FROM T_BUC_ARRAY;
+------------+-----+---+
| A          | B   | C |
+------------+-----+---+
| ARRAY[2,3] | 3.3 | c |
| ARRAY[1,2] | 1.1 | a |
| ARRAY[1,2] | 2.2 | b |
+------------+-----+---+
3 rows selected.
Running time elapsed:      0.44 Seconds
SQL> 
SQL> -- 创建以2个字段分桶的分桶表
SQL> CREATE TABLE T_BUC2 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A, C) INTO 4 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC2;
+--------+-----------------------------------------------------------------------------------------------------------------------+
| TABLE  | CREATE_TABLE                                                                                                          |
+--------+-----------------------------------------------------------------------------------------------------------------------+
| T_BUC2 | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC2(A INTEGER,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A, C) INTO 4 BUCKETS |
+--------+-----------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC2';
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                       |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/524954b8-e6ca-4766-aff7-18b7a8c96407","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A","C"],"bucketNum":4} |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.08 Seconds
SQL> -- 插入数据，3个分桶
SQL> INSERT INTO T_BUC2 SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.00 Seconds
SQL> -- 查询表T_BUC2
SQL> SELECT * FROM T_BUC2;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
+------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.33 Seconds
SQL> 
SQL> -- 创建以所有字段分桶的分桶表
SQL> CREATE TABLE T_BUC3 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A, B, C) INTO 4 BUCKETS;
0 rows affected
Running time elapsed:      0.06 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC3;
+--------+--------------------------------------------------------------------------------------------------------------------------+
| TABLE  | CREATE_TABLE                                                                                                             |
+--------+--------------------------------------------------------------------------------------------------------------------------+
| T_BUC3 | CREATE TABLE IF NOT EXISTS PUBLIC.T_BUC3(A INTEGER,B DECIMAL(10,2),C VARCHAR(255)) CLUSTERED BY (A, B, C) INTO 4 BUCKETS |
+--------+--------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC3';
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                           |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs:///user/ldb1/data/home/PUBLIC/tables/PUBLIC/351eec10-fd70-4427-818b-8352d5bea334","format":"parquet","parameters":{},"partitionColumns":[],"bucketColumns":["A","B","C"],"bucketNum":4} |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，4个分桶
SQL> INSERT INTO T_BUC3 SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC;
10 rows affected
Running time elapsed:      1.96 Seconds
SQL> -- 查询表T_BUC3
SQL> SELECT * FROM T_BUC3;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
+------+---------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.38 Seconds
SQL> 
SQL> -- 创建以func(col)分桶的分桶表
SQL> CREATE TABLE T_BUC_MONTH (A DATE, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (MONTH(A)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column MONTH in statement [CREATE TABLE T_BUC_MONTH (A DATE, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (MONTH(A)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_LEN (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (LENGTH(C)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column LENGTH in statement [CREATE TABLE T_BUC_LEN (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (LENGTH(C)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_ABS (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ABS(A)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column ABS in statement [CREATE TABLE T_BUC_ABS (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ABS(A)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_MOD (A BIGINT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (MOD(A, 2)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column MOD in statement [CREATE TABLE T_BUC_MOD (A BIGINT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (MOD(A, 2)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_FLOOR (A FLOAT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (FLOOR(A)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column FLOOR in statement [CREATE TABLE T_BUC_FLOOR (A FLOAT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (FLOOR(A)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_TODATE (A TIMESTAMP, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (TO_DATE(A)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column TO_DATE in statement [CREATE TABLE T_BUC_TODATE (A TIMESTAMP, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (TO_DATE(A)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_DAY (A TIMESTAMP, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (DAY(TO_DATE(A))) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column DAY in statement [CREATE TABLE T_BUC_DAY (A TIMESTAMP, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (DAY(TO_DATE(A))) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> CREATE TABLE T_BUC_ROUND (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ROUND(B)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column ROUND in statement [CREATE TABLE T_BUC_ROUND (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ROUND(B)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 创建以多个func(col)分桶的分桶表
SQL> CREATE TABLE T_BUC2_FUNC2 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ABS(A), LENGTH(C)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column ABS in statement [CREATE TABLE T_BUC2_FUNC2 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (ABS(A), LENGTH(C)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 创建以func(col)和col分桶的分桶表
SQL> CREATE TABLE T_BUC2_FUNC1 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A, LENGTH(C)) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column LENGTH in statement [CREATE TABLE T_BUC2_FUNC1 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A, LENGTH(C)) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> 
SQL> -- 创建以不存在字段分桶的分桶表
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (D) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: invalided column D in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (D) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- CLUSTERED拼写错误
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTER BY (A) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: CLUSTER in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTER BY (A) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 缺失括号
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY A INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: A required: ( in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY A INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 缺失逗号
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A C) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: C in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A C) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 缺失BY
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED (A) INTO 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: ( required: BY in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED (A) INTO 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- 桶个数为负数
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO -4 BUCKETS;
java.sql.SQLSyntaxErrorException: number of target columns does not match that of query expression in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO -4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> -- BUCKETS拼写错误
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKET;
java.sql.SQLSyntaxErrorException: unexpected token: BUCKET required: BUCKETS in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKET]
Running time elapsed:      0.00 Seconds
SQL> -- 缺失INTO
SQL> CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) 4 BUCKETS;
java.sql.SQLSyntaxErrorException: unexpected token: 4 required: INTO in statement [CREATE TABLE T_BUC (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) 4 BUCKETS]
Running time elapsed:      0.00 Seconds
SQL> 
SQL> -- 创建外部分桶表T_BUC_EX1
SQL> CREATE EXTERNAL TABLE T_BUC_EX1(TINT INT,TDECIMAL DECIMAL(10,2),TVARCHAR VARCHAR(255))
   > LOCATION ('HDFSRPC_URL/partition_bucket1') FORMAT 'csv' (DELIMITER ',') CLUSTERED BY (TINT) INTO 4 BUCKETS;
REWROTED SQL> Your SQL has been changed to:
REWROTED    > CREATE EXTERNAL TABLE T_BUC_EX1(TINT INT,TDECIMAL DECIMAL(10,2),TVARCHAR VARCHAR(255))
REWROTED    > LOCATION ('hdfs://node73:8020/user/testdb73/jenkins/work/linkoopdb-sql-test-ruanna/partition_bucket1') FORMAT 'csv' (DELIMITER ',') CLUSTERED BY (TINT) INTO 4 BUCKETS
0 rows affected
Running time elapsed:      0.54 Seconds
SQL> -- 查看创建表的ddl
SQL> SHOW CREATE TABLE T_BUC_EX1;
+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| TABLE     | CREATE_TABLE                                                                                                                                                                                                                                                                            |
+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| T_BUC_EX1 | CREATE EXTERNAL TABLE IF NOT EXISTS PUBLIC.T_BUC_EX1(TINT INTEGER,TDECIMAL DECIMAL(10,2),TVARCHAR VARCHAR(255)) LOCATION ('hdfs://node73:8020/user/testdb73/jenkins/work/linkoopdb-sql-test-ruanna/partition_bucket1') FORMAT 'csv' (DELIMITER ',' ) CLUSTERED BY (TINT) INTO 4 BUCKETS |
+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.00 Seconds
SQL> -- 查看系统表中该表的分桶字段
SQL> select PERIPHERAL_INFO from information_schema.system_tables where TABLE_NAME = 'T_BUC_EX1';
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| PERIPHERAL_INFO                                                                                                                                                                                                     |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"location":"hdfs://node73:8020/user/testdb73/jenkins/work/linkoopdb-sql-test-ruanna/partition_bucket1","format":"csv","parameters":{"DELIMITER":","},"partitionColumns":[],"bucketColumns":["TINT"],"bucketNum":4} |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row selected.
Running time elapsed:      0.07 Seconds
SQL> -- 插入数据，2个分桶
SQL> INSERT INTO T_BUC_EX1 SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC; 
10 rows affected
Running time elapsed:      0.50 Seconds
SQL> -- 查询表T_BUC_EX1
SQL> SELECT * FROM T_BUC_EX1;
+------+----------+------------------------------------------------------------------------------------------------------+
| TINT | TDECIMAL | TVARCHAR                                                                                             |
+------+----------+------------------------------------------------------------------------------------------------------+
| 7566 | 2106.95  | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5201.08  | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 4784.35  | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15  | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 3207.93  | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7839 | 7676.08  | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7839 | 442.02   | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7698 | 5546.49  | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 2136.13  | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7782 | 5468.79  | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
+------+----------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.16 Seconds
SQL> 
SQL> -- 全部读出外部分桶表数据到内部表
SQL> CREATE TABLE T_EX_DATA (TINT INT,TDECIMAL DECIMAL(10,2),TVARCHAR VARCHAR(255));
0 rows affected
Running time elapsed:      0.10 Seconds
SQL> INSERT INTO T_EX_DATA SELECT * FROM T_BUC_EX1;
10 rows affected
Running time elapsed:      3.76 Seconds
SQL> SELECT * FROM T_EX_DATA;
+------+----------+------------------------------------------------------------------------------------------------------+
| TINT | TDECIMAL | TVARCHAR                                                                                             |
+------+----------+------------------------------------------------------------------------------------------------------+
| 7566 | 2106.95  | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5201.08  | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 4784.35  | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15  | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7839 | 3207.93  | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA                                       |
| 7839 | 7676.08  | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA                                              |
| 7839 | 442.02   | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj                                               |
| 7698 | 5546.49  | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 2136.13  | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7782 | 5468.79  | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
+------+----------+------------------------------------------------------------------------------------------------------+
10 rows selected.
Running time elapsed:      0.29 Seconds
SQL> 
SQL> -- 创建分桶pallas表
SQL> CREATE TABLE T_BUC_PALLAS (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKETS ENGINE PALLAS;
java.sql.SQLSyntaxErrorException: syntax error or access rule violation in direct statement: BUCKETS is not supported by current engine in statement [CREATE TABLE T_BUC_PALLAS (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 4 BUCKETS ENGINE PALLAS]
Running time elapsed:      0.00 Seconds
SQL> 
SQL> -- 某个分桶的数据丢失，读出外部分桶表部分数据到内部表
   > 
   > -- 使用分桶表创建视图
SQL> CREATE VIEW V_BUC AS SELECT * FROM T_BUC_INT WHERE A = 7566;
0 rows affected
Running time elapsed:      0.12 Seconds
SQL> -- 查询视图
SQL> SELECT * FROM V_BUC;
+------+---------+---------------------------------------------+
| A    | B       | C                                           |
+------+---------+---------------------------------------------+
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB |
+------+---------+---------------------------------------------+
1 row selected.
Running time elapsed:      0.34 Seconds
SQL> 
SQL> -- 2个分桶表union
SQL> CREATE TABLE T_BUC_1 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 3 BUCKETS;
0 rows affected
Running time elapsed:      0.08 Seconds
SQL> CREATE TABLE T_BUC_2 (A INT, B DECIMAL(10,2), C VARCHAR(255)) CLUSTERED BY (A) INTO 2 BUCKETS;
0 rows affected
Running time elapsed:      0.05 Seconds
SQL> INSERT INTO T_BUC_1 SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC WHERE TBIGINT BETWEEN 1000001 AND 1000005; 
5 rows affected
Running time elapsed:      0.82 Seconds
SQL> INSERT INTO T_BUC_2 SELECT TINT, TDECIMAL, TVARCHAR FROM EX_PART_BUC WHERE TBIGINT BETWEEN 1000006 AND 10000010;
5 rows affected
Running time elapsed:      0.68 Seconds
SQL> SELECT * FROM T_BUC_1;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7782 | 5468.79 | NRHDqobzUJxjRXDBKtb4rJwlNJB6R0YFI71h                                                                 |
+------+---------+------------------------------------------------------------------------------------------------------+
5 rows selected.
Running time elapsed:      0.27 Seconds
SQL> SELECT * FROM T_BUC_2;
+------+---------+----------------------------------------------------------------+
| A    | B       | C                                                              |
+------+---------+----------------------------------------------------------------+
| 7839 | 3207.93 | 64d5uZovFhCv8mZPz8Rc2Dz7OmA29hWAYiNOLDaqVBRgRbweACRHMj2ShVddhA |
| 7839 | 7676.08 | HOZ9esgErLL9m6V952H2I5WG07thtDCPAFldiD4FvUJqvKrO60ApBgA        |
| 7839 | 442.02  | PwPuzd0JZUBJMUBbMtRBUwOIF9MO6iYd0Bagf4oERj6w8Rt1RxKonj         |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                  |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                            |
+------+---------+----------------------------------------------------------------+
5 rows selected.
Running time elapsed:      0.21 Seconds
SQL> SELECT A FROM T_BUC_1 UNION SELECT A FROM T_BUC_2;
+------+
| A    |
+------+
| 7566 |
| 7698 |
| 7839 |
| 7782 |
+------+
4 rows selected.
Running time elapsed:      4.37 Seconds
SQL> 
SQL> -- 2个视图union
SQL> CREATE VIEW V_BUC_1 AS SELECT * FROM T_BUC_INT WHERE A = 7698;
0 rows affected
Running time elapsed:      0.05 Seconds
SQL> SELECT * FROM V_BUC UNION SELECT * FROM V_BUC_1;
+------+---------+------------------------------------------------------------------------------------------------------+
| A    | B       | C                                                                                                    |
+------+---------+------------------------------------------------------------------------------------------------------+
| 7698 | 5201.08 | sI5kjlaWflJDMA6e3rWZplFnKCSObDxUt9AV                                                                 |
| 7698 | 2136.13 | 2pngVLiHPk3gIE07ISn                                                                                  |
| 7698 | 4784.35 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
| 7566 | 2106.95 | T9oP1tEEw4I85RFHX4MUnw0JWnO1TI21Dm8RFnknjIB                                                          |
| 7698 | 5546.49 | dRjG33kXpT8cM0FCOMYyn9jvuefrc                                                                        |
| 7698 | 5509.15 | o8b6aIqJwkdYGCfwOKvdorrh5DmlugoTESOexlDOI53uUyYeFrXaeSSdOwiv4AY8LzHeaRHEKg5iSbGFLDRDq3Rd4oDgggyDBFm3 |
+------+---------+------------------------------------------------------------------------------------------------------+
6 rows selected.
Running time elapsed:      4.49 Seconds
Running time elapsed:     63.49 Seconds
SQL> exit
Disconnected.
